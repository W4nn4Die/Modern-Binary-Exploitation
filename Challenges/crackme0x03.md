#### crackme0x03

###### Inspect the binary

```sh
root@kali:~/binexp/challenges# ./crackme0x03
IOLI Crackme Level 0x03
Password: shdfghj
Invalid Password!
root@kali:~/binexp/challenges#
```

###### radare2

```sh
root@kali:~/binexp/challenges# radare2 crackme0x03
[0x08048360]>
```

```sh
[0x08048360]> aaa
[x] Analyze all flags starting with sym. and entry0 (aa)
[x] Analyze len bytes of instructions for references (aar)
[x] Analyze function calls (aac)
[ ] [*] Use -AA or aaaa to perform additional experimental analysis.
[x] Constructing a function name for fcn.* and sym.func.* functions (aan))
[0x08048360]>
```

```sh
[0x08048360]> afl
0x080482f8    1 23           sym._init
0x08048320    1 6            sym.imp.__libc_start_main
0x08048330    1 6            sym.imp.scanf
0x08048340    1 6            sym.imp.strlen
0x08048350    1 6            sym.imp.printf
0x08048360    1 33           entry0
0x08048384    3 33           fcn.08048384
0x080483b0    6 47           sym.__do_global_dtors_aux
0x080483e0    4 50           sym.frame_dummy
0x08048414    4 90           sym.shift
0x0804846e    4 42           sym.test
0x08048498    1 128          sym.main
0x08048520    4 99           sym.__libc_csu_init
0x08048590    1 5            sym.__libc_csu_fini
0x08048595    1 4            sym.__i686.get_pc_thunk.bx
0x080485a0    4 35           sym.__do_global_ctors_aux
0x080485c4    1 26           sym._fini
[0x08048360]>
```

```sh
[0x08048360]> s sym.main
[0x08048498]>
```

```sh
[0x08048498]> pd $r @ main
            ;-- main:
/ (fcn) sym.main 128
|   sym.main ();
|           ; var int local_ch @ ebp-0xc
|           ; var int local_8h @ ebp-0x8
|           ; var int local_4h @ ebp-0x4
|           ; var int local_4h_2 @ esp+0x4
|           ; DATA XREF from 0x08048377 (entry0)
|           0x08048498      55             push ebp
|           0x08048499      89e5           mov ebp, esp
|           0x0804849b      83ec18         sub esp, 0x18
|           0x0804849e      83e4f0         and esp, 0xfffffff0
|           0x080484a1      b800000000     mov eax, 0
|           0x080484a6      83c00f         add eax, 0xf
|           0x080484a9      83c00f         add eax, 0xf
|           0x080484ac      c1e804         shr eax, 4
|           0x080484af      c1e004         shl eax, 4
|           0x080484b2      29c4           sub esp, eax
|           0x080484b4      c70424108604.  mov dword [esp], str.IOLI_Crackme_Level_0x03_n ; [0x8048610:4]=0x494c4f49 LEA str.IOLI_Crackme_Level_0x03_n ; "IOLI Crackme Level 0x03." @ 0x8048610
|           0x080484bb      e890feffff     call sym.imp.printf        ; int printf(const char *format);
|           0x080484c0      c70424298604.  mov dword [esp], str.Password: ; [0x8048629:4]=0x73736150 LEA str.Password: ; "Password: " @ 0x8048629
|           0x080484c7      e884feffff     call sym.imp.printf        ; int printf(const char *format);
|           0x080484cc      8d45fc         lea eax, dword [ebp - local_4h]
|           0x080484cf      89442404       mov dword [esp + local_4h_2], eax
|           0x080484d3      c70424348604.  mov dword [esp], 0x8048634  ; [0x8048634:4]=0x6425 ; "%d"
|           0x080484da      e851feffff     call sym.imp.scanf         ; int scanf(const char *format);
|           0x080484df      c745f85a0000.  mov dword [ebp - local_8h], 0x5a ; 'Z'
|           0x080484e6      c745f4ec0100.  mov dword [ebp - local_ch], 0x1ec
|           0x080484ed      8b55f4         mov edx, dword [ebp - local_ch]
|           0x080484f0      8d45f8         lea eax, dword [ebp - local_8h]
|           0x080484f3      0110           add dword [eax], edx
|           0x080484f5      8b45f8         mov eax, dword [ebp - local_8h]
|           0x080484f8      0faf45f8       imul eax, dword [ebp - local_8h]
|           0x080484fc      8945f4         mov dword [ebp - local_ch], eax
|           0x080484ff      8b45f4         mov eax, dword [ebp - local_ch]
|           0x08048502      89442404       mov dword [esp + local_4h_2], eax
|           0x08048506      8b45fc         mov eax, dword [ebp - local_4h]
|           0x08048509      890424         mov dword [esp], eax
|           0x0804850c      e85dffffff     call sym.test
|           0x08048511      b800000000     mov eax, 0
|           0x08048516      c9             leave
\           0x08048517      c3             ret
            0x08048518      90             nop
            0x08048519      90             nop
            0x0804851a      90             nop
            0x0804851b      90             nop
            0x0804851c      90             nop
            0x0804851d      90             nop
            0x0804851e      90             nop
            0x0804851f      90             nop
/ (fcn) sym.__libc_csu_init 99
|   sym.__libc_csu_init (int arg_8h, int arg_ch, int arg_10h);
|           ; var int local_10h @ ebp-0x10
|           ; arg int arg_8h @ ebp+0x8
|           ; arg int arg_ch @ ebp+0xc
|           ; arg int arg_10h @ ebp+0x10
|           ; var int local_4h @ esp+0x4
|           ; var int local_8h @ esp+0x8
|           ; DATA XREF from 0x08048370 (entry0)
|           0x08048520      55             push ebp
|           0x08048521      89e5           mov ebp, esp
|           0x08048523      57             push edi
|           0x08048524      56             push esi
|           0x08048525      31f6           xor esi, esi
|           0x08048527      53             push ebx
|           0x08048528      e868000000     call sym.__i686.get_pc_thunk.bx
|           0x0804852d      81c3c71a0000   add ebx, 0x1ac7
|           0x08048533      83ec1c         sub esp, 0x1c
|           0x08048536      e8bdfdffff     call sym._init
|           0x0804853b      8d8318ffffff   lea eax, dword [ebx - 0xe8]
|           0x08048541      8d9318ffffff   lea edx, dword [ebx - 0xe8]
|           0x08048547      8945f0         mov dword [ebp - local_10h], eax
|           0x0804854a      29d0           sub eax, edx
|           0x0804854c      c1f802         sar eax, 2
|           0x0804854f      39c6           cmp esi, eax
[0x08048498]>
```

###### Solving crackme0x03

1. Program gets the user input from ```scanf``` call at ```0x080484da```

```sh
|           0x080484cc      8d45fc         lea eax, dword [ebp - local_4h]
|           0x080484cf      89442404       mov dword [esp + local_4h_2], eax
|           0x080484d3      c70424348604.  mov dword [esp], 0x8048634  ; [0x8048634:4]=0x6425 ; "%d"
|           0x080484da      e851feffff     call sym.imp.scanf         ; int scanf(const char *format);
```

The first argument is a integer constant which can be deduces using the format specifier ```%d```

The second argument is the memory location to store the scanf() result. The result of scanf() is stored in local stack variable at ```ebp - local_4h```.

2. Disassembly after ```scanf```

```sh
|           0x080484df      c745f85a0000.  mov dword [ebp - local_8h], 0x5a ; 'Z'
|           0x080484e6      c745f4ec0100.  mov dword [ebp - local_ch], 0x1ec
|           0x080484ed      8b55f4         mov edx, dword [ebp - local_ch]
|           0x080484f0      8d45f8         lea eax, dword [ebp - local_8h]
|           0x080484f3      0110           add dword [eax], edx
|           0x080484f5      8b45f8         mov eax, dword [ebp - local_8h]
|           0x080484f8      0faf45f8       imul eax, dword [ebp - local_8h]
|           0x080484fc      8945f4         mov dword [ebp - local_ch], eax
|           0x080484ff      8b45f4         mov eax, dword [ebp - local_ch]
|           0x08048502      89442404       mov dword [esp + local_4h_2], eax
|           0x08048506      8b45fc         mov eax, dword [ebp - local_4h]
|           0x08048509      890424         mov dword [esp], eax
|           0x0804850c      e85dffffff     call sym.test
```

```sh
mov dword [ebp - local_8h], 0x5a		; ebp - local_8h = 90
mov dword [ebp - local_ch], 0x1ec 	; ebp - local_ch = 492
mov edx, dword [ebp - local_ch]		; edx = 492
lea eax, dword [ebp - local_8h] 		; eax -> ebp - local_8h
add dword [eax], edx 					; ebp - local_8h = eax + edx = 90 + 492 = 582
mov eax, dword [ebp - local_8h] 		; eax = 582
imul eax, dword [ebp - local_8h] 		; eax = eax * 582 = 582 * 582 = 338724
mov dword [ebp - local_ch], eax 		; ebp - local_ch = 338724
mov eax, dword [ebp - local_ch]	   	; eax = 338724
mov dword [esp + local_4h_2], eax 	; esp + local_4h_2 = 338724
mov eax, dword [ebp - local_4h]	 	; eax = user input
mov dword [esp], eax 					;
call sym.test								;
```