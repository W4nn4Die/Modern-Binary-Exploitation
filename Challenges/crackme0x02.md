#### crackme0x02

###### Inspect the binary

```sh
root@kali:~/binexp/challenges# ./crackme0x02
IOLI Crackme Level 0x02
Password: dfvd
Invalid Password!
root@kali:~/binexp/challenges#
```

###### radare2

```sh
root@kali:~/binexp/challenges# radare2 crackme0x02
[0x08048330]>
```

```sh
[0x08048330]> aaa
[x] Analyze all flags starting with sym. and entry0 (aa)
[x] Analyze len bytes of instructions for references (aar)
[x] Analyze function calls (aac)
[ ] [*] Use -AA or aaaa to perform additional experimental analysis.
[x] Constructing a function name for fcn.* and sym.func.* functions (aan))
[0x08048330]>
[0x08048330]> afl
0x080482d4    1 23           sym._init
0x080482fc    1 6            sym.imp.__libc_start_main
0x0804830c    1 6            sym.imp.scanf
0x0804831c    1 6            sym.imp.printf
0x08048330    1 33           entry0
0x08048354    3 33           fcn.08048354
0x08048380    6 47           sym.__do_global_dtors_aux
0x080483b0    4 50           sym.frame_dummy
0x080483e4    4 144          sym.main
0x08048480    4 99           sym.__libc_csu_init
0x080484f0    1 5            sym.__libc_csu_fini
0x080484f5    1 4            sym.__i686.get_pc_thunk.bx
0x08048500    4 35           sym.__do_global_ctors_aux
0x08048524    1 26           sym._fini
[0x08048330]>
```

```sh
[0x08048330]> s sym.main
[0x080483e4]>
```

```sh
[0x080483e4]> pd $r @ main
            ;-- main:
/ (fcn) sym.main 144
|   sym.main ();
|           ; var int local_ch @ ebp-0xc
|           ; var int local_8h @ ebp-0x8
|           ; var int local_4h @ ebp-0x4
|           ; var int local_4h_2 @ esp+0x4
|           ; DATA XREF from 0x08048347 (entry0)
|           0x080483e4      55             push ebp
|           0x080483e5      89e5           mov ebp, esp
|           0x080483e7      83ec18         sub esp, 0x18
|           0x080483ea      83e4f0         and esp, 0xfffffff0
|           0x080483ed      b800000000     mov eax, 0
|           0x080483f2      83c00f         add eax, 0xf
|           0x080483f5      83c00f         add eax, 0xf
|           0x080483f8      c1e804         shr eax, 4
|           0x080483fb      c1e004         shl eax, 4
|           0x080483fe      29c4           sub esp, eax
|           0x08048400      c70424488504.  mov dword [esp], str.IOLI_Crackme_Level_0x02_n ; [0x8048548:4]=0x494c4f49 LEA str.IOLI_Crackme_Level_0x02_n ; "IOLI Crackme Level 0x02." @ 0x8048548
|           0x08048407      e810ffffff     call sym.imp.printf        ; int printf(const char *format);
|           0x0804840c      c70424618504.  mov dword [esp], str.Password: ; [0x8048561:4]=0x73736150 LEA str.Password: ; "Password: " @ 0x8048561
|           0x08048413      e804ffffff     call sym.imp.printf        ; int printf(const char *format);
|           0x08048418      8d45fc         lea eax, dword [ebp - local_4h]
|           0x0804841b      89442404       mov dword [esp + local_4h_2], eax
|           0x0804841f      c704246c8504.  mov dword [esp], 0x804856c  ; [0x804856c:4]=0x50006425 ; "%d"
|           0x08048426      e8e1feffff     call sym.imp.scanf         ; int scanf(const char *format);
|           0x0804842b      c745f85a0000.  mov dword [ebp - local_8h], 0x5a ; 'Z'
|           0x08048432      c745f4ec0100.  mov dword [ebp - local_ch], 0x1ec
|           0x08048439      8b55f4         mov edx, dword [ebp - local_ch]
|           0x0804843c      8d45f8         lea eax, dword [ebp - local_8h]
|           0x0804843f      0110           add dword [eax], edx
|           0x08048441      8b45f8         mov eax, dword [ebp - local_8h]
|           0x08048444      0faf45f8       imul eax, dword [ebp - local_8h]
|           0x08048448      8945f4         mov dword [ebp - local_ch], eax
|           0x0804844b      8b45fc         mov eax, dword [ebp - local_4h]
|           0x0804844e      3b45f4         cmp eax, dword [ebp - local_ch]
|       ,=< 0x08048451      750e           jne 0x8048461
|       |   0x08048453      c704246f8504.  mov dword [esp], str.Password_OK_:__n ; [0x804856f:4]=0x73736150 LEA str.Password_OK_:__n ; "Password OK :)." @ 0x804856f
|       |   0x0804845a      e8bdfeffff     call sym.imp.printf        ; int printf(const char *format);
|      ,==< 0x0804845f      eb0c           jmp 0x804846d
|      ||   ; JMP XREF from 0x08048451 (sym.main)
|      |`-> 0x08048461      c704247f8504.  mov dword [esp], str.Invalid_Password__n ; [0x804857f:4]=0x61766e49 LEA str.Invalid_Password__n ; "Invalid Password!." @ 0x804857f
|      |    0x08048468      e8affeffff     call sym.imp.printf        ; int printf(const char *format);
|      |    ; JMP XREF from 0x0804845f (sym.main)
|      `--> 0x0804846d      b800000000     mov eax, 0
|           0x08048472      c9             leave
\           0x08048473      c3             ret
            0x08048474      90             nop
            0x08048475      90             nop
            0x08048476      90             nop
            0x08048477      90             nop
            0x08048478      90             nop
            0x08048479      90             nop
            0x0804847a      90             nop
            0x0804847b      90             nop
            0x0804847c      90             nop
            0x0804847d      90             nop
            0x0804847e      90             nop
            0x0804847f      90             nop
/ (fcn) sym.__libc_csu_init 99
|   sym.__libc_csu_init (int arg_8h, int arg_ch, int arg_10h);
|           ; var int local_10h @ ebp-0x10
|           ; arg int arg_8h @ ebp+0x8
|           ; arg int arg_ch @ ebp+0xc
|           ; arg int arg_10h @ ebp+0x10
|           ; var int local_4h @ esp+0x4
|           ; var int local_8h @ esp+0x8
|           ; DATA XREF from 0x08048340 (entry0)
|           0x08048480      55             push ebp
|           0x08048481      89e5           mov ebp, esp
|           0x08048483      57             push edi
|           0x08048484      56             push esi
|           0x08048485      31f6           xor esi, esi
|           0x08048487      53             push ebx
|           0x08048488      e868000000     call sym.__i686.get_pc_thunk.bx
|           0x0804848d      81c3671b0000   add ebx, 0x1b67
|           0x08048493      83ec1c         sub esp, 0x1c
[0x080483e4]>
```

###### Solving crackme0x02

1. Program gets the user input from ```scanf``` call at ```0x08048426```

	```sh
	|           0x08048418      8d45fc         lea eax, dword [ebp - local_4h]
	|           0x0804841b      89442404       mov dword [esp + local_4h_2], eax
	|           0x0804841f      c704246c8504.  mov dword [esp], 0x804856c  ; [0x804856c:4]=0x50006425 ; "%d"
	|           0x08048426      e8e1feffff     call sym.imp.scanf         ; int scanf(const char *format);
	```
	
	The first argument is a integer constant which can be deduces using the format specifier ```%d```
	
	The second argument is the memory location to store the scanf() result. The result of scanf() is stored in local stack variable at ```ebp - local_4h```.
	
2. Disassembly after ```scanf```

	```sh
	|           0x0804842b      c745f85a0000.  mov dword [ebp - local_8h], 0x5a ; 'Z'
	|           0x08048432      c745f4ec0100.  mov dword [ebp - local_ch], 0x1ec
	|           0x08048439      8b55f4         mov edx, dword [ebp - local_ch]
	|           0x0804843c      8d45f8         lea eax, dword [ebp - local_8h]
	|           0x0804843f      0110           add dword [eax], edx
	|           0x08048441      8b45f8         mov eax, dword [ebp - local_8h]
	|           0x08048444      0faf45f8       imul eax, dword [ebp - local_8h]
	|           0x08048448      8945f4         mov dword [ebp - local_ch], eax
	|           0x0804844b      8b45fc         mov eax, dword [ebp - local_4h]
	|           0x0804844e      3b45f4         cmp eax, dword [ebp - local_ch]
	```
	
	```sh
	root@kali:~/binexp/challenges# echo $((0x5a))
	90
	root@kali:~/binexp/challenges#
	root@kali:~/binexp/challenges# echo $((0x1ec))
	492
	root@kali:~/binexp/challenges#
	```
	
	```sh
	mov dword [ebp - local_8h], 0x5a	; ebp - local_8h = 90
	mov dword [ebp - local_ch], 0x1ec	; ebp - local_ch = 492
	mov edx, dword [ebp - local_ch] 	; edx = 492
	lea eax, dword [ebp - local_8h]		; eax -> ebp - local_8h
	add dword [eax], edx 			; ebp - local_8h = eax + edx = 90 + 492 = 582
	mov eax, dword [ebp - local_8h] 	; eax = 582
	imul eax, dword [ebp - local_8h]    	; eax = eax * 582 = 582 * 582 = 338724
	mov dword [ebp - local_ch], eax 	; ebp - local_ch = 338724
	mov eax, dword [ebp - local_4h] 	; eax = user input
	cmp eax, dword [ebp - local_ch]		; cmp user input and 338724
	```
	
	```sh
	root@kali:~/binexp/challenges# ./crackme0x02
	IOLI Crackme Level 0x02
	Password: 338724
	Password OK :)
	root@kali:~/binexp/challenges#
	```
